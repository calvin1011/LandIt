<!DOCTYPE html>
<html lang="en">
<head>
    <title>Firebase Auth Test</title>
    <script type="module">
        // Import Firebase functions from auth.js
        import { login, signup, logout, onAuthChange } from "./auth.js";

        // Signup function (calls signup from auth.js)
        window.handleSignup = async function() {
            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;
            try {
                await signup(email, password);
                alert("Signup successful!");
            } catch (error) {
                alert("Error: " + error.message);
            }
        }

        // Login function (calls login from auth.js)
        window.handleLogin = async function() {
            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;
            try {
                const user = await login(email, password);
                const token = await user.getIdToken();  // ðŸ”¹ Get Firebase Token
                console.log("Firebase Token:", token);  // Log token in Console
                localStorage.setItem("firebaseToken", token);  // Store token in localStorage
                alert("Login successful!");
            } catch (error) {
                alert("Error: " + error.message);
            }
        }

        // Logout function (calls logout from auth.js)
        window.handleLogout = async function() {
            try {
                await logout();
                localStorage.removeItem("firebaseToken"); // âœ… Remove token on logout
                console.log("User logged out. Token cleared.");
                alert("User logged out!");
            } catch (error) {
                alert("Error: " + error.message);
            }
        }

        // Detect authentication state changes and update UI
        onAuthChange(user => {
            document.getElementById("status").innerText = user ? `Logged in as: ${user.email}` : "Not logged in";
            if (user) {
                user.getIdToken().then(token => {
                    console.log("ðŸ”¥ Firebase Token (onAuthChange):", token);
                    localStorage.setItem("firebaseToken", token);
                });
            }
        });
    </script>
</head>
<body>
<h2>Firebase Auth Test</h2>
<p id="status">Checking login status...</p>

<label for="email"></label><input type="email" id="email" placeholder="Email">
<label for="password"></label><input type="password" id="password" placeholder="Password">

<button onclick="handleSignup()">Signup</button>
<button onclick="handleLogin()">Login</button>
<button onclick="handleLogout()">Logout</button>
</body>
</html>
